
## 数据类型

## 单线程

新版本不一定是单线程？




## 节点

通过CRC16算法计算key对应的slot，然后路由到该slot所在的redis节点




## 分布式锁

### “占坑”原理

同时去请求，占到则处理逻辑，否则通过自旋锁方式等待重试

> 问题：如果拿到锁之后，出现异常，导致未删除锁，则造成死锁

### 给锁设置过期时间

即使业务出现问题，没有主动删除，也会自动过期删除

> 问题：如果执行expire命令设置过期时间时，出现异常，则依然会出现死锁

### 获取锁和设置锁过期时间，必须是原子操作

redis支持setNxEx命令

> 问题：拿到锁之后执行业务逻辑，如果正好要删除锁时，锁又过期了，另一个线程拿到了锁并且设置了新value，那么这时再删除就是删除别人的锁了。

### 确保加锁和解锁都是原子操作

使用redis+Lua脚本

保证加锁【占位+过期时间】和删除锁【判断+删除】的原子性




## 锁的自动续期 todo
---